<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Others">
  <meta property="og:description" content="Others" />
  <meta property="og:title" content="Pedro Marques Pereira - Others" />
  <meta property="og:url" content="https://pedromarquespereira.com/work/others" />
  <meta property="og:image" content="https://pedromarquespereira.com/work/img/others/prints/1440/prints_13.webp"/>
  <meta property="og:type" content="website"/>
  <title>Pedro Marques Pereira</title>
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:opsz@14..32&display=swap" as="style" onload="this.rel='stylesheet'">
  <noscript>
    <link href="https://fonts.googleapis.com/css2?family=Inter:opsz@14..32&display=swap" rel="stylesheet">
  </noscript>
  <link rel="icon" type="image/png" sizes="48x48" href="../favicon-48x48.png">
  <link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
  <link rel="shortcut icon" type="image/png" href="../favicon.png">
  <link rel="alternate" hreflang="en" href="https://pedromarquespereira.com/work/others" />
  <link rel="alternate" hreflang="pt" href="https://pedromarquespereira.com/work/others/pt" />
  <link rel="alternate" hreflang="x-default" href="https://pedromarquespereira.com/work/others" />
  <style>
  /* === CSS RESET === */
  html,
  body,
  div,
  span,
  h1,
  h2,
  h3,
  p,
  a,
  img,
  picture,
  iframe,
  ul,
  li
  {
    margin: 0;
    padding: 0;
    border: 0;
    outline: 0;
    font-size: 100%;
    vertical-align: baseline;
    background: transparent;
  }
  body {
    background-color: #000;
    height: 100%;
    line-height: 1;
  }
  /*FADE*/
  .fade {
    opacity: 0;
    animation: fadein 0.3s ease-in forwards;
  }
  @keyframes fadein {
    to {
      opacity: 1;
      }
    }
  /* === TYPOGRAPHY === */
  .back,
  .btn,
  .dropd {
    font-family: 'Inter', sans-serif;
    text-decoration: none;
    font-size: 23px;
    color: white;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.6);
  }
  .dropd{
    display: block;
    margin-top: 9px;
    font-size: 15px;
    color: white;
  }
  .top,
  .bottom {
    position: fixed;
    width: 100%;
    left: 50%;
    transform: translateX(-50%);
    height: 60px;
    background-color: #000;
    box-shadow: 0 0 1px #000, 0 0 3px #000, 0 0 7px #000, 0 0 10px #000;
  }
  .top {
    top: 0;
    max-width: 100dvw;
  }
  .bottom {
    bottom: 0;
    outline: #000 3px;
  }
  /* === COMPONENTS === */
  .back,
  .menu{
    position: fixed;
    display: flex;
    top: 20px;
    z-index: 1;
  }
  .back {
    left: 15px;
    right:auto;
    font-size: 30px;
  }
  .menu {
    right:15px;
    left: auto;
  }
  .dropdown {
  display: none;
  text-align: right;
  }
  .dropd {
  cursor: pointer;
  }
  .dropcontent {display:none;}
  /* DROPvsHORIZONTAL */
  @media screen and (max-width: 500px) {
  .dropdown {
    display: block;
  }
  .h-menu {
    display: none;
  }
  }
  @media screen and (min-width: 501px) {
  .dropdown {
    display: none;
  }
  .h-menu {
    display: flex;
    gap: 15px;
  }
  }
  .c,
  .lang{
    z-index: 1;
    position: fixed;
    display: flex;
    top:auto;
  }
  .c{
    bottom:3px;
    left: auto;
    right: 5px;
  }
  .c span{
    font-family: sans-serif;
    font-weight: 300;
    font-size: 8px;
    color: white;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.6);
  }
  .lang {
    bottom: 30px;
    left: 15px;
  }
  /*--------------Project---------------*/
  .title{
    display: flex;
    position: fixed;
    top:20px;
    left:40px;
    color:#fff;
    align-items: baseline;
    text-align: left;
    font-family: 'Inter', sans-serif;
  }
  .title h1{
    font-size: 23px;
    font-weight: 300;
  }
  .others{
    display: flex;
    position: absolute;
    z-index: -1;
    width: calc(100dvw - 30px);
    height:calc(100dvh - 150px);
    margin:68px 15px;
    align-items: start;
    gap:10px;
    box-sizing: border-box;
  }
  .arch{
    display: flex;
    position: relative;
    overflow: hidden;
    width:100%;
    height:100%;
    flex-direction: column;
    background-size: cover;
    background-position: center;
    justify-content: flex-end;
    border-radius: 5px;
    cursor: pointer;
  }
  .arch picture {
    position: absolute;
    width: 100%;
    height: 100%;
    z-index: -1;
    border-radius: 5px;
    overflow: hidden;
  }
  .arch picture img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 5px;
  }
  .info{
    display: flex;
    margin: 15px;
    flex-direction: column;
    text-shadow: 0 0 1px #000, 0 0 3px #000, 0 0 5px #000;
  }
/*letters*/
  .info h2,
  .info span{
    font-family: 'Inter', sans-serif;
    color: #fff;
  }
  .info h2{
    font-size: 23px;
    font-weight: normal;
  }
  .info span{
    margin-top: 10px;
    font-size: 16px;
  }
  @media screen and (max-width: 1100px) {
      .others {
        display: grid;
        grid-template-columns: 1fr;
        grid-template-rows: repeat(6, 1fr);
        height: calc(100dvh - 150px);
      }
  }
  @media screen and (max-width: 1100px) and (max-height: 759px) {
    .arch {
      justify-content: center;
    }
    .info {
      margin: 0 15px;
    }
  }
  @media screen and (max-width: 1100px) and (max-height: 615px) {
    .info {
    display: flex;
    flex-direction: row;
    gap: 5px;
    margin: 0 15px;
  }
    .info h2 {
      line-height: 0.75;
    }
    .info span {
      line-height: 0.1; /* slightly bigger line-height to match visual height */
    }
  }
  /*___________gallery---------*/
  .gallery{
    z-index: 1;
    display: none;
    position: fixed;
    width:calc(100dvw - 30px);
    height:calc(100dvh - 15px);
    margin:0 15px;
    background-color: #000;
  }
  .gallery-back{
    display: flex;
    top: 18px;
    left: 15px;
    right:auto;
    position: fixed;
    font-size: 24px;
    color:#fff;
    font-family: sans-serif;
  }
  .gallery-close{
    cursor: pointer;
  }
  .title span{
    font-size: 15px;
    margin-left: 4px;
  }
  .gallery-img{
    position: fixed;
    top:50%;
    left:50%;
    transform: translate(-50%,-50%);
    display: flex;
    flex-direction: column;
    -webkit-user-select: none;
    -ms-user-select: none;
    user-select: none;
  }
  .gallery-img img{
    max-width: calc(100dvw - 30px);
    max-height: calc(100dvh - 160px);
  }
  iframe{
    width:1440px;
    height:1080px;
    max-width: calc(100dvw - 30px);
    max-height: calc(100dvh - 160px);
  }
  .gallery-img span{
    font-family: 'Inter', sans-serif;
    color: #fff;
  }
  .arrows{
    display: block;
    width:100%;
    margin-top: 8px;
  }
  .arrows span{
    font-size: 20px;
    cursor: pointer;
    margin: 0 2px 0 auto;
  }
  .left{
    position: absolute;
    display: none;
    left:0;
    right:auto;
    margin-left: 5px;

  }
  .right{
    position: absolute;
    display: inline;
    left:auto;
    right:0;
    margin-right: 5px;
  }
  .infoclick{
    display: flex;
    font-size: 10px;
    margin: 4px 18px 0 auto;
  }
  .descrip{
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .descrip span {
    font-size: 14px;
    margin: 4px auto;
  }
  </style>
  <link rel="stylesheet" href="../style.css" media="print" onload="this.media='all'">
</head>
<body class="fade">
  <header class="top">
    <a href="../work" class="back">*</a>
    <nav class="menu">
      <div class="dropdown"><span class="dropd">&bull;&bull;&bull;</span>
                            <ul class="dropcontent">
                              <li><a href="../about" class="btn">about</a></li>
                              <li><a href="../contact" class="btn">contact</a></li>
                              <li><a href="https://www.instagram.com/pedro.marques.pereira/" class="btn" target="_blank" rel="noopener noreferrer">social</a></li>
                            </ul>
      </div>
      <div class="h-menu">
        <a href="../about" class="btn">about</a>
        <a href="../contact" class="btn">contact</a>
        <a href="https://www.instagram.com/pedro.marques.pereira/" class="btn" target="_blank" rel="noopener noreferrer">social</a>
      </div>
    </nav>
      <div class="title">
        <h1>Others</h1>
      </div>
  </header>
  <main>
    <section class="others">
      <section class="arch" data-id="1">
        <picture>
          <source media="(max-width: 480px)" srcset="./img/others/covers/480/darkday_cover.webp">
          <source media="(max-width: 720px)" srcset="./img/others/covers/720/darkday_cover.webp">
          <img src="./img/others/covers/1080/darkday_cover.webp" fetchpriority="high" alt="Dark Day">
        </picture>
        <div class="info">
          <h2>dark day</h2>
          <span>2023...</span>
        </div>
      </section>
      <section class="arch" data-id="2">
        <picture>
          <source media="(max-width: 480px)" srcset="./img/others/covers/480/obon_cover.webp">
          <source media="(max-width: 720px)" srcset="./img/others/covers/720/obon_cover.webp">
          <img src="./img/others/covers/1080/obon_cover.webp" fetchpriority="high" alt="Obon">
        </picture>
        <div class="info">
          <h2>obon</h2>
          <span>2023</span>
        </div>
      </section>
      <section class="arch" data-id="3">
        <picture>
          <source media="(max-width: 480px)" srcset="./img/others/covers/480/studies_cover.webp">
          <source media="(max-width: 720px)" srcset="./img/others/covers/720/studies_cover.webp">
          <img src="./img/others/covers/1080/studies_cover.webp" fetchpriority="high" alt="Video Studies">
        </picture>
        <div class="info">
          <h2>studies</h2>
          <span>2022...</span>
        </div>
      </section>
      <section class="arch" data-id="4">
        <picture>
          <source media="(max-width: 480px)" srcset="./img/others/covers/480/prints_cover.webp">
          <source media="(max-width: 720px)" srcset="./img/others/covers/720/prints_cover.webp">
          <img src="./img/others/covers/1080/prints_cover.webp" fetchpriority="high" alt="Prints">
        </picture>
        <div class="info">
          <h2>prints</h2>
          <span>2019...</span>
        </div>
      </section>
      <section class="arch" data-id="5">
        <picture>
          <source media="(max-width: 480px)" srcset="./img/others/covers/480/untitled_cover.webp">
          <source media="(max-width: 720px)" srcset="./img/others/covers/720/untitled_cover.webp">
          <img src="./img/others/covers/1080/untitled_cover.webp" fetchpriority="high" alt="Untitled">
        </picture>
        <div class="info">
          <h2>untitled</h2>
          <span>2019 - 2022</span>
        </div>
      </section>
      <section class="arch" data-id="6">
        <picture>
          <source media="(max-width: 480px)" srcset="./img/others/covers/480/films_cover.webp">
          <source media="(max-width: 720px)" srcset="./img/others/covers/720/films_cover.webp">
          <img src="./img/others/covers/1080/films_cover.webp" fetchpriority="high" alt="Films">
        </picture>
        <div class="info">
          <h2>films</h2>
          <span>2015 - 2021</span>
        </div>
      </section>
    </section>
    <section class="gallery" id="darkday" data-id="1">
      <div class="gallery-back">
        <span class="gallery-close">×</span>
        <div class="title">
          <h1>Dark Day</h1>
          <span>2023 - ongoing</span>
        </div>
      </div>
      <div class="gallery-img">
        <img class="one" loading="lazy"
             data-src="./img/others/darkday/1080/darkday_1.webp"
             data-srcset="./img/others/darkday/480/darkday_1.webp 480w,
                          ./img/others/darkday/640/darkday_1.webp 640w,
                          ./img/others/darkday/1080/darkday_1.webp 1080w,
                          ./img/others/darkday/1440/darkday_1.webp 1440w"
             sizes="(max-width: 480px) 480px,
                    (max-width: 640px) 640px,
                    (max-width: 1080px) 1080px,
                    1440px"
             width="1080"
             height="1350"
             alt="Dark Day">
        <div class="arrows">
          <span class="left"><</span>
          <span class="right">></span>
        </div>
      </section>
    </div>
    <section class="gallery" id="obon" data-id="2">
      <div class="gallery-back">
        <span class="gallery-close">×</span>
        <div class="title">
          <h1>Obon</h1>
          <span>2023</span>
        </div>
      </div>
      <div class="gallery-img">
        <div class="gallery-video-placeholder" data-video="https://www.youtube-nocookie.com/embed/Ukpb5HJr_4A?si=aJyf8KX6wqrt--nb&rel=0" data-aspect="8:3"></div>
      </div>
    </section>
    <section class="gallery" id="studies" data-id="3">
      <div class="gallery-back">
        <span class="gallery-close">×</span>
        <div class="title">
          <h1>Studies (video)</h1>
          <span>2022 - ongoing</span>
        </div>
      </div>
      <div class="gallery-img">
        <div class="gallery-video-placeholder" data-video="https://www.youtube-nocookie.com/embed/videoseries?si=y5fT_oT3okoNpu47&amp;list=PLibxdEk1cX3TTViXyuHOtQDl8owreKdgm&rel=0"></div>
        <span class="infoclick">click next for more</span>
      </div>
    </section>
    <section class="gallery" id="prints" data-id="4">
      <div class="gallery-back">
        <span class="gallery-close">×</span>
        <div class="title">
          <h1>Prints</h1>
          <span>2019 - ongoing</span>
        </div>
      </div>
      <div class="gallery-img">
        <img class="one" loading="lazy"
             data-src="./img/others/prints/1080/prints_1.webp"
             data-srcset="./img/others/prints/480/prints_1.webp 480w,
                          ./img/others/prints/640/prints_1.webp 640w,
                          ./img/others/prints/1080/prints_1.webp 1080w,
                          ./img/others/prints/1440/prints_1.webp 1440w"
             sizes="(max-width: 480px) 480px,
                    (max-width: 640px) 640px,
                    (max-width: 1080px) 1080px,
                    1440px"
             width="1080"
             height="1512"
             alt="Prints">
        <div class="arrows">
          <span class="left"><</span>
          <span class="right">></span>
        </div>
        <div class="descrip">
          <span class="size">12.7 x 17.8cm</span>
          <span class="type">silver gelatin print</span>
        </div>
      </div>
    </section>
    <section class="gallery" id="untitled" data-id="5">
      <div class="gallery-back">
        <span class="gallery-close">×</span>
        <div class="title">
          <h1>Untitled</h1>
          <span>2019 - 2022</span>
        </div>
      </div>
      <div class="gallery-img">
        <img class="one" loading="lazy"
             data-src="./img/others/untitled/1080/untitled_1.webp"
             data-srcset="./img/others/untitled/480/untitled_1.webp 480w,
                          ./img/others/untitled/640/untitled_1.webp 640w,
                          ./img/others/untitled/1080/untitled_1.webp 1080w,
                          ./img/others/untitled/1440/untitled_1.webp 1440w"
             sizes="(max-width: 480px) 480px,
                    (max-width: 640px) 640px,
                    (max-width: 1080px) 1080px,
                    1440px"
             width="1080"
             height="1260"
             alt="Untitled">
        <div class="arrows">
          <span class="left"><</span>
          <span class="right">></span>
        </div>
      </div>
    </section>
    <section class="gallery" id="films" data-id="6">
      <div class="gallery-back">
        <span class="gallery-close">×</span>
        <div class="title">
          <h1>Films</h1>
          <span>2015 - 2021</span>
        </div>
      </div>
      <div class="gallery-img">
        <div class="gallery-video-placeholder" data-video="https://www.youtube-nocookie.com/embed/videoseries?si=Vx_RBxrSCJ_5_egj&amp;list=PLibxdEk1cX3SnSuxdsxSMC4pzCw1a_vOa&rel=0"></div>
        <span class="infoclick">click next for more</span>
      </div>
    </section>
  </main>
  <footer class="bottom">
      <div class="lang"><a href="./others/pt" lang="pt" class="btn">pt</a></div>
      <div class="c"><span>© Pedro Marques Pereira 2026</span></div>
  </footer>
  <script defer>
document.addEventListener('DOMContentLoaded', () => {
  // ---------- Helpers ----------
  const qs = sel => document.querySelector(sel);
  const qsa = sel => Array.from(document.querySelectorAll(sel));
  const attr = (el, name) => el ? el.getAttribute(name) : null;

  // ---------- Cached elements ----------
  const dropTrigger = qs('.dropd');
  const dropContent = qs('.dropcontent');
  const arches = qsa('.arch');       // clickable tiles
  const galleries = qsa('.gallery'); // gallery sections

  // ---------- Dropdown  ----------
  if (dropTrigger && dropContent) {
    let dropdownOpen = false;

    const toggleDropdown = (show) => dropContent.classList.toggle('show', !!show);

    // Click on trigger toggles
    dropTrigger.addEventListener('click', (e) => {
      e.stopPropagation();
      dropdownOpen = !dropdownOpen;
      toggleDropdown(dropdownOpen);
    });

    // Hover behavior
    let hoverTimeout = null;
    const clearHoverTimeout = () => { if (hoverTimeout) { clearTimeout(hoverTimeout); hoverTimeout = null; } };

    dropTrigger.addEventListener('mouseover', () => { clearHoverTimeout(); toggleDropdown(true); dropdownOpen = true; });
    dropContent.addEventListener('mouseover', () => { clearHoverTimeout(); toggleDropdown(true); dropdownOpen = true; });

    const handleMouseOut = () => {
      clearHoverTimeout();
      hoverTimeout = setTimeout(() => {
        // if neither hovered, close
        if (!dropTrigger.matches(':hover') && !dropContent.matches(':hover')) {
          dropdownOpen = false;
          toggleDropdown(false);
        }
      }, 100);
    };

    dropTrigger.addEventListener('mouseout', handleMouseOut);
    dropContent.addEventListener('mouseout', handleMouseOut);

    // Close dropdown on outside click
    document.addEventListener('click', (e) => {
      if (!dropContent.contains(e.target) && !dropTrigger.contains(e.target)) {
        dropdownOpen = false;
        toggleDropdown(false);
      }
    });
  }

  // ---------- IFrame lazy-insert (video placeholders) ----------
  function openGalleryIframe(placeholder) {
    if (!placeholder || placeholder.querySelector('iframe')) return;

    const aspectAttr = placeholder.dataset.aspect || '4:3';
    const [w, h] = aspectAttr.split(':').map(Number);
    const src = placeholder.dataset.video;
    if (!src) return;

    const iframe = document.createElement('iframe');
    iframe.src = src;
    iframe.title = 'YouTube video player';
    iframe.frameBorder = '0';
    iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share';
    iframe.allowFullscreen = true;
    iframe.referrerPolicy = 'strict-origin-when-cross-origin';
    iframe.style.display = 'block';
    iframe.style.border = 'none';
    iframe.dataset.aspect = `${w}:${h}`;
    // apply classes so resizeHandler can find them
    iframe.className = aspectAttr === '8:3' ? 'pan' : aspectAttr === '5:4' ? 'film' : 'cine';

    placeholder.appendChild(iframe);
    resizeHandler();
  }

  // ---------- Gallery data  ----------
  const galleriesData = {
    darkday: [
      'darkday_1.webp','darkday_2.webp','darkday_3.webp','darkday_4.webp',
      'darkday_5.webp','darkday_6.webp','darkday_7.webp','darkday_8.webp',
      'darkday_9.webp','darkday_10.webp','darkday_11.webp'
    ],
    prints: [
      { filename: 'prints_1.webp', size: '12.7 x 17.8 cm', type: 'silver gelatin print' },
      { filename: 'prints_2.webp', size: '12.7 x 17.8 cm', type: 'silver gelatin print' },
      { filename: 'prints_3.webp', size: '10.2 x 12.7 cm', type: 'silver gelatin print' },
      { filename: 'prints_4.webp', size: '17.8 x 24 cm', type: 'silver gelatin print' },
      { filename: 'prints_5.webp', size: '12.7 x 17.8 cm', type: 'silver gelatin print' },
      { filename: 'prints_6.webp', size: '17.8 x 24 cm', type: 'silver gelatin print' },
      { filename: 'prints_7.webp', size: '12.7 x 17.8 cm', type: 'silver gelatin print' },
      { filename: 'prints_8.webp', size: '12.7 x 17.8 cm', type: 'silver gelatin print' },
      { filename: 'prints_9.webp', size: '12.7 x 17.8 cm', type: 'silver gelatin print' },
      { filename: 'prints_10.webp', size: '12.7 x 17.8 cm', type: 'silver gelatin print' },
      { filename: 'prints_11.webp', size: '17.8 x 24 cm', type: 'silver gelatin print' },
      { filename: 'prints_12.webp', size: '12.7 x 17.8 cm', type: 'silver gelatin print' },
      { filename: 'prints_13.webp', size: '23.3 x 24.1 cm', type: 'silver gelatin print' },
      { filename: 'prints_14.webp', size: '24 x 30 cm', type: 'silver gelatin print' },
      { filename: 'prints_15.webp', size: '24 x 30 cm', type: 'silver gelatin print' },
      { filename: 'prints_16.webp', size: '49.3 x 60.2 cm', type: 'inkjet print' },
      { filename: 'prints_17.webp', size: '65.7 x 83.7 cm', type: 'inkjet print' }
    ],
    untitled: [
      'untitled_1.webp','untitled_2.webp','untitled_3.webp','untitled_4.webp',
      'untitled_5.webp','untitled_6.webp','untitled_7.webp','untitled_8.webp',
      'untitled_9.webp','untitled_10.webp'
    ]
  };

  // ---------- Utility functions for building src/srcset ----------
  function buildSrcset(baseFolder, filename) {
    const sizes = [480, 640, 1080, 1440];
    return sizes.map(size => `./img/others/${baseFolder}/${size}/${filename} ${size}w`).join(', ');
  }
  function buildDataSrc(baseFolder, filename, defaultSize = 1080) {
    return `./img/others/${baseFolder}/${defaultSize}/${filename}`;
  }

  // ---------- Focus helper ----------
  const galleryStates = {}; // will hold state per gallery (by id)
  let focusedGalleryId = null;

  function setFocus(container, id) {
    // schedule focus to avoid interrupting click sequences
    requestAnimationFrame(() => {
      try { container.focus(); } catch (err) {}
      focusedGalleryId = id;
    });
  }

  // ---------- Setup gallery images (create DOM only if container empty) ----------
  function setupGalleryImages(galleryId, baseFolder) {
    const galleryElement = document.getElementById(galleryId);
    if (!galleryElement) return;

    const container = galleryElement.querySelector('.gallery-img');
    if (!container) return;

    const existingImages = container.querySelectorAll('img');
    // Only populate if container is empty or contains no <img>
    if (existingImages.length === 0) {
      // Clear placeholder content but keep other non-image elements (like title/back)
      container.innerHTML = '';

      const galleryImages = galleriesData[galleryId] || [];

      galleryImages.forEach((imgData, idx) => {
        let filename, size, type;
        if (typeof imgData === 'string') {
          filename = imgData;
        } else {
          filename = imgData.filename;
          size = imgData.size;
          type = imgData.type;
        }

        const img = document.createElement('img');
        img.className = 'one';
        img.loading = 'lazy';
        // set data attributes to load later when gallery opens
        img.setAttribute('data-src', buildDataSrc(baseFolder, filename));
        img.setAttribute('data-srcset', buildSrcset(baseFolder, filename));
        img.setAttribute('sizes', '(max-width: 480px) 480px, (max-width: 640px) 640px, (max-width: 1080px) 1080px, 1440px');
        img.setAttribute('width', '1080');
        img.setAttribute('alt', galleryId);
        container.appendChild(img);

        // If item contains size/type, append descriptive div
        if (size || type) {
          const descrip = document.createElement('div');
          descrip.className = 'descrip';
          if (size) {
            const spanSize = document.createElement('span');
            spanSize.className = 'size';
            spanSize.textContent = size;
            descrip.appendChild(spanSize);
          }
          if (type) {
            const spanType = document.createElement('span');
            spanType.className = 'type';
            spanType.textContent = type;
            descrip.appendChild(spanType);
          }
          container.appendChild(descrip);
        }
      });

      // Append arrows block if not present
      if (!container.querySelector('.arrows')) {
        const arrows = document.createElement('div');
        arrows.className = 'arrows';
        arrows.innerHTML = '<span class="left">&lt;</span><span class="right">&gt;</span>';
        container.appendChild(arrows);
      }
    }
  }

  // ---------- Open gallery  ----------
  let currentGallery = null; // element reference

  function openGalleryElement(gal) {
    if (!gal) return;
    // Hide all galleries first
    galleries.forEach(g => { g.style.display = 'none'; });

    // Show selected gallery
    gal.classList.add('fade');
    gal.style.display = 'block';
    currentGallery = gal;

    // Insert iframe if needed
    const iframePlaceholder = gal.querySelector('.gallery-video-placeholder');
    if (iframePlaceholder) openGalleryIframe(iframePlaceholder);

    // Lazy-load any images with data-src
    gal.querySelectorAll('img[data-src]').forEach(img => {
      if (!img.src) {
        img.removeAttribute('loading'); // allow browser to load immediately
        img.src = img.dataset.src;
        if (img.dataset.srcset) {
          img.srcset = img.dataset.srcset;
          img.sizes = img.getAttribute('sizes') || '';
        }
      }
    });

    // Reset gallery state index & update
    const state = galleryStates[gal.id];
    if (state) {
      state.currentIndex = 0;
      state.updateImage();
      setFocus(state.container, gal.id);
    }

    resizeHandler();
  }

  // Arch click handlers (use cached arches)
  arches.forEach(arch => {
    arch.addEventListener('click', () => {
      const id = arch.dataset.id; // numeric in HTML (1..)
      // find the gallery with matching data-id attr
      const gal = document.querySelector(`.gallery[data-id="${id}"]`);
      if (!gal) return;
      openGalleryElement(gal);
    });

    // keyboard accessibility
    arch.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') arch.click();
    });
  });

  // ---------- Close gallery (close button / Escape) ----------
  qsa('.gallery-back > span:first-child').forEach(btn => {
    btn.addEventListener('click', () => {
      const gal = btn.closest('.gallery');
      if (gal) {
        gal.style.display = 'none';
        if (currentGallery === gal) currentGallery = null;
      }
    });
  });

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && currentGallery) {
      currentGallery.style.display = 'none';
      currentGallery = null;
    }
  });

  // ---------- Build galleryStates and attach arrows/keyboard navigation ----------
  Object.keys(galleriesData).forEach(key => {
    // ensure gallery DOM is populated if necessary
    setupGalleryImages(key, key);

    const container = document.getElementById(key);
    const imagesArray = galleriesData[key];
    if (!container) return;

    const imgElement = container.querySelector('.gallery-img img'); // first image element
    const leftArrow = container.querySelector('.arrows .left');
    const rightArrow = container.querySelector('.arrows .right');

    if (!imgElement || !leftArrow || !rightArrow) return;

    galleryStates[key] = {
      currentIndex: 0,
      imgElement,
      leftArrow,
      rightArrow,
      images: imagesArray,
      container,
      baseFolder: key,

      updateImage() {
        const item = this.images[this.currentIndex];
        let filename, size, type;
        if (typeof item === 'string') {
          filename = item;
        } else {
          filename = item.filename;
          size = item.size;
          type = item.type;
        }

        const src = buildDataSrc(this.baseFolder, filename);
        const srcset = buildSrcset(this.baseFolder, filename);

        // Apply attributes to the displayed <img> (lazy -> loaded)
        this.imgElement.removeAttribute('loading');
        this.imgElement.src = src;
        this.imgElement.srcset = srcset;
        this.imgElement.sizes = '(max-width: 480px) 480px, (max-width: 640px) 640px, (max-width: 1080px) 1080px, 1440px';

        // arrows visibility
        this.leftArrow.style.display = this.currentIndex === 0 ? 'none' : 'inline';
        this.rightArrow.style.display = this.currentIndex === this.images.length - 1 ? 'none' : 'inline';

        // update description fields if present in DOM
        const sizeSpan = this.container.querySelector('.descrip .size');
        if (sizeSpan) sizeSpan.textContent = size || '';
        const typeSpan = this.container.querySelector('.descrip .type');
        if (typeSpan) typeSpan.textContent = type || '';

        // ensure sizing recalculation
        resizeHandler();
      }
    };

    const state = galleryStates[key];
    // initialize
    state.updateImage();

    // click handlers for arrows
    leftArrow.addEventListener('click', (e) => {
      e.stopPropagation();
      if (state.currentIndex > 0) {
        state.currentIndex--;
        state.updateImage();
      }
      setFocus(state.container, key);
    });

    rightArrow.addEventListener('click', (e) => {
      e.stopPropagation();
      if (state.currentIndex < state.images.length - 1) {
        state.currentIndex++;
        state.updateImage();
      }
      setFocus(state.container, key);
    });

    // focus tracking
    container.addEventListener('click', () => setFocus(container, key));
    container.addEventListener('focus', () => { focusedGalleryId = key; });
  });

  // ---------- Global click delegation for image click navigation inside visible gallery ----------
  document.body.addEventListener('click', (e) => {
    // if clicked inside a visible gallery image area
    const gal = e.target.closest('.gallery');
    if (!gal) return;
    // only handle if gallery is currently displayed
    if (getComputedStyle(gal).display === 'none') return;

    const state = galleryStates[gal.id];
    if (!state) return;

    // image click navigation: if clicked on an <img> inside gallery-img
    if (e.target.tagName === 'IMG' && e.target.closest('.gallery-img')) {
      const img = e.target;
      const imgs = Array.from(gal.querySelectorAll('.gallery-img img'));
      const index = imgs.indexOf(img);
      if (index === -1) return;

      const rect = img.getBoundingClientRect();
      const clickX = e.clientX - rect.left;
      const halfway = rect.width / 2;

      if (index === 0) {
        // first image: clicking advances
        if (state.currentIndex < state.images.length - 1) {
          state.currentIndex++;
          state.updateImage();
        }
      } else if (index === state.images.length - 1) {
        // last image: clicking goes back
        if (state.currentIndex > 0) {
          state.currentIndex--;
          state.updateImage();
        }
      } else {
        // middle images: left half -> previous, right half -> next
        if (clickX < halfway) {
          if (state.currentIndex > 0) {
            state.currentIndex--;
            state.updateImage();
          }
        } else {
          if (state.currentIndex < state.images.length - 1) {
            state.currentIndex++;
            state.updateImage();
          }
        }
      }
      setFocus(state.container, gal.id);
    }
  });

  // ---------- MutationObserver  ----------
  // Using a small MutationObserver only to detect when 'style' attribute changes for galleries (display toggles)
  const miniObserver = new MutationObserver(mutations => {
    mutations.forEach(m => {
      if (m.type === 'attributes' && m.attributeName === 'style') {
        const target = m.target;
        if (target.classList && target.classList.contains('gallery')) {
          const isVisible = window.getComputedStyle(target).display !== 'none';
          if (isVisible && galleryStates[target.id]) {
            setFocus(galleryStates[target.id].container, target.id);
          }
        }
      }
    });
  });
  // observe only gallery nodes for attribute changes
  galleries.forEach(g => miniObserver.observe(g, { attributes: true, attributeFilter: ['style'] }));

  // ---------- Keyboard navigation for focused gallery ----------
  window.addEventListener('keydown', (e) => {
    if (!focusedGalleryId) return;
    const state = galleryStates[focusedGalleryId];
    if (!state) return;

    if (e.key === 'ArrowLeft' && state.currentIndex > 0) {
      e.preventDefault();
      state.currentIndex--;
      state.updateImage();
    } else if (e.key === 'ArrowRight' && state.currentIndex < state.images.length - 1) {
      e.preventDefault();
      state.currentIndex++;
      state.updateImage();
    }
  });

  // ---------- Initial resize handling call ----------
  resizeHandler();
}); // end DOMContentLoaded

// ---------- Resize Handler (stands outside DOMContentLoaded so arrows/resizes work on window events) ----------
function resizeHandler() {
  const maxWidth = window.innerWidth - 30;
  const maxHeight = window.innerHeight - 160;
  const galleries = document.querySelectorAll('.gallery');

  galleries.forEach(gallery => {
    // helper to resize an iframe frame with known aspect ratio classes
    const resizeFrame = (selector, aspectW, aspectH) => {
      const el = gallery.querySelector(selector);
      if (!el) return;
      let width = maxWidth;
      let height = (width * aspectH) / aspectW;
      if (height > maxHeight) {
        height = maxHeight;
        width = (height * aspectW) / aspectH;
      }
      el.style.width = width + 'px';
      el.style.height = height + 'px';
    };

    resizeFrame('.cine', 4, 3);
    resizeFrame('.pan', 8, 3);
    resizeFrame('.film', 5, 4);

    // Resize single displayed image (keeps natural aspect ratio)
    const img = gallery.querySelector('.gallery-img img');
    if (img && img.src) {
      const temp = new Image();
      temp.src = img.src;
      temp.onload = () => {
        const ratio = temp.naturalWidth / temp.naturalHeight;
        if (maxWidth / ratio <= maxHeight) {
          img.style.width = `${maxWidth}px`;
          img.style.height = 'auto';
        } else {
          img.style.width = 'auto';
          img.style.height = `${maxHeight}px`;
        }
      };
    }
  });
}

window.addEventListener('resize', resizeHandler);
</script>
</body>
</html>
